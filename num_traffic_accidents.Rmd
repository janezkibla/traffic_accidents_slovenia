---
title: "Število prometnih nesreč v Sloveniji v času"
author: "Roman Luštrik (roman.lustrik@biolitika.si)"
date: "`r Sys.Date()`"
output: html_document
---
```{r setup}
library(ggplot2)
```

```{r}
load(file.path("data", "raw_accident_data.RData"))

rad <- raw.accident.data
rm(raw.accident.data)

rad$DatumPN <- as.Date(rad$DatumPN, format = "%d.%m.%Y")
```

Calculate number of accidents per day.
```{r}
nad <- aggregate(
  ZaporednaStevilkaPN ~ DatumPN, data = rad,
  FUN = function(x) length(unique(x))
)
colnames(nad) <- c("datum", "num_accidents")

nad$year <- format(nad$datum, format = "%Y")

yearly.avg <- aggregate(num_accidents ~ year, data = nad, FUN = mean)
```

```{r}
ggplot(nad, aes(x = datum, y = num_accidents)) +
  theme_bw() +
  geom_col() +
  geom_hline(data = yearly.avg, aes(yintercept = num_accidents), color = "grey20") +
  facet_wrap(~ year, scales = "free_x", ncol = 1, strip.position = "right")

ggsave(file.path("figures", "figure-2-num-accidents-in-time.pdf"), width = 8, height = 24)
```

```{r}
save(nad, file = file.path("data", "num_acc_year.RData"))
```